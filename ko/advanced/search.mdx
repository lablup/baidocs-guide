# 검색 설정

BaiDocs는 고급 필터링, 강조 표시 및 다국어 지원을 통해 모든 문서 콘텐츠에서 즉석 지능형 검색을 제공하는 강력한 내장 검색 시스템을 포함합니다.

## 검색 시스템 개요

### 기능

- **즉석 검색**: 타이핑할 때 실시간 결과 제공
- **전문 검색**: 모든 콘텐츠, 제목 및 메타데이터 검색
- **다국어 지원**: 특정 언어 내에서 또는 모든 언어에서 검색
- **고급 필터링**: 책, 섹션, 콘텐츠 유형 및 태그별 필터링
- **지능적 순위**: 관련성과 컨텍스트에 따른 결과 순위 지정
- **키보드 네비게이션**: 접근성을 위한 완전한 키보드 지원
- **강조 표시**: 결과 및 콘텐츠에서 검색 용어 강조 표시

### 검색 아키텍처

```
검색 인덱스 생성:
콘텐츠 파일 → 인덱싱 → 검색 데이터베이스 → 검색 API → 사용자 인터페이스

컴포넌트:
├── 콘텐츠 인덱서      # MDX 파일 처리
├── 검색 데이터베이스   # 인덱싱된 콘텐츠 저장
├── 검색 API          # 쿼리 처리
├── 검색 UI           # 사용자 인터페이스
└── 결과 강조 표시     # 용어 강조 표시
```

## 자동 검색 설정

### 기본 구성

검색은 기본적으로 활성화되어 있으며 다음을 자동으로 인덱싱합니다:

- 모든 MDX 콘텐츠 파일
- 페이지 제목 및 제목
- Frontmatter 메타데이터
- 네비게이션 구조
- 코드 블록 (선택 사항)
- 이미지 alt 텍스트

### 빌드 타임 인덱싱

검색 인덱스는 빌드 중에 생성됩니다:

```bash
npm run build
# 자동으로 검색 인덱스 생성
# 출력: _data/search/index.json
```

## 검색 구성

### 기본 구성

책 설정에서 검색을 구성할 수 있습니다:

```yaml
# book.config.yaml
id: my-documentation
title: My Documentation

# 검색 구성
search:
  enabled: true

  # 인덱싱 옵션
  indexing:
    includeContent: true
    includeHeadings: true
    includeCodeBlocks: true
    includeFrontmatter: true

    # 콘텐츠 처리
    minWordLength: 3
    maxResultsPerPage: 10
    excerptLength: 150

  # UI 구성
  ui:
    placeholder: "Search documentation..."
    noResultsMessage: "No results found"
    shortcut: "/"
    showRecentSearches: true
    showSearchStats: true
```

### 고급 검색 옵션

```yaml
# book.config.yaml
search:
  # 고급 인덱싱
  indexing:
    # 특정 파일 유형 포함/제외
    includeFiles:
      - "*.mdx"
      - "*.md"
    excludeFiles:
      - "**/README.md"
      - "**/_*.mdx"

    # 콘텐츠 섹션 가중치 (높을수록 더 중요)
    sectionWeights:
      title: 10
      heading1: 8
      heading2: 6
      heading3: 4
      content: 1
      codeblock: 2

    # 언어별 어간 추출
    stemming:
      enabled: true
      languages:
        - en
        - ko

    # 불용어 (무시할 단어)
    stopWords:
      en: ["the", "is", "at", "which", "on"]
      ko: ["이", "그", "저", "것", "등"]

  # 검색 동작
  behavior:
    # 퍼지 매칭 허용치
    fuzzyThreshold: 0.6

    # 최소 쿼리 길이
    minQueryLength: 2

    # 결과 강조 표시
    highlighting:
      enabled: true
      className: "search-highlight"
      maxHighlights: 3

    # 자동 제안
    suggestions:
      enabled: true
      maxSuggestions: 5
      includePopular: true
```

## 검색 UI 사용자 정의

### 사용자 정의 검색 컴포넌트

사용자 정의 검색 인터페이스를 생성할 수 있습니다:

```typescript
// components/CustomSearch.tsx
import React, { useState, useEffect } from 'react';
import { useSearch } from '@baidocs/search';

interface SearchResult {
  id: string;
  title: string;
  excerpt: string;
  url: string;
  type: string;
  score: number;
  highlights: string[];
}

export function CustomSearch() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState<SearchResult[]>([]);
  const [isLoading, setIsLoading] = useState(false);

  const { search } = useSearch();

  useEffect(() => {
    if (query.length < 2) {
      setResults([]);
      return;
    }

    setIsLoading(true);

    search(query, {
      limit: 20,
      includeHighlights: true,
      filters: {
        type: ['page', 'section'],
        language: 'en'
      }
    })
    .then(setResults)
    .finally(() => setIsLoading(false));
  }, [query, search]);

  return (
    <div className="search-container">
      <div className="search-input-wrapper">
        <input
          type="text"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder="Search documentation..."
          className="search-input"
          aria-label="Search documentation"
        />
        {isLoading && <div className="search-loading">Searching...</div>}
      </div>

      {results.length > 0 && (
        <div className="search-results">
          <div className="search-stats">
            Found {results.length} results
          </div>

          {results.map((result) => (
            <div key={result.id} className="search-result">
              <a href={result.url} className="search-result-link">
                <h3 className="search-result-title">
                  <span dangerouslySetInnerHTML={{ __html: result.title }} />
                </h3>
                <p className="search-result-excerpt">
                  <span dangerouslySetInnerHTML={{ __html: result.excerpt }} />
                </p>
                <div className="search-result-meta">
                  <span className="search-result-type">{result.type}</span>
                  <span className="search-result-score">Score: {result.score.toFixed(2)}</span>
                </div>
              </a>
            </div>
          ))}
        </div>
      )}

      {query.length >= 2 && results.length === 0 && !isLoading && (
        <div className="search-no-results">
          <p>No results found for "{query}"</p>
          <div className="search-suggestions">
            <p>Try:</p>
            <ul>
              <li>Checking your spelling</li>
              <li>Using different keywords</li>
              <li>Using more general terms</li>
            </ul>
          </div>
        </div>
      )}
    </div>
  );
}
```

### 검색 스타일링

사용자 정의 검색 인터페이스 스타일링:

```css
/* styles/search.css */

.search-container {
  position: relative;
  width: 100%;
  max-width: 600px;
}

.search-input-wrapper {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid #e5e7eb;
  border-radius: 0.5rem;
  font-size: 1rem;
  transition: border-color 0.2s ease;
}

.search-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search-loading {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.875rem;
  color: #6b7280;
}

.search-results {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 0.5rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  z-index: 50;
  max-height: 500px;
  overflow-y: auto;
}

.search-stats {
  padding: 0.75rem 1rem;
  font-size: 0.875rem;
  color: #6b7280;
  border-bottom: 1px solid #f3f4f6;
}

.search-result {
  border-bottom: 1px solid #f3f4f6;
}

.search-result:last-child {
  border-bottom: none;
}

.search-result-link {
  display: block;
  padding: 1rem;
  text-decoration: none;
  color: inherit;
  transition: background-color 0.2s ease;
}

.search-result-link:hover {
  background-color: #f9fafb;
}

.search-result-title {
  font-size: 1rem;
  font-weight: 600;
  margin: 0 0 0.5rem 0;
  color: #1f2937;
}

.search-result-excerpt {
  font-size: 0.875rem;
  color: #6b7280;
  line-height: 1.5;
  margin: 0 0 0.5rem 0;
}

.search-result-meta {
  display: flex;
  gap: 1rem;
  font-size: 0.75rem;
  color: #9ca3af;
}

.search-result-type {
  background: #f3f4f6;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  text-transform: uppercase;
  font-weight: 500;
}

/* 검색 강조 표시 */
.search-highlight {
  background-color: #fef3c7;
  color: #92400e;
  font-weight: 600;
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
}

/* 결과 없음 상태 */
.search-no-results {
  padding: 2rem 1rem;
  text-align: center;
}

.search-suggestions {
  margin-top: 1rem;
  text-align: left;
}

.search-suggestions ul {
  margin: 0.5rem 0;
  padding-left: 1.5rem;
}

.search-suggestions li {
  margin: 0.25rem 0;
  color: #6b7280;
  font-size: 0.875rem;
}

/* 다크 모드 지원 */
@media (prefers-color-scheme: dark) {
  .search-input {
    background: #1f2937;
    border-color: #374151;
    color: #f9fafb;
  }

  .search-input:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
  }

  .search-results {
    background: #1f2937;
    border-color: #374151;
  }

  .search-result-link:hover {
    background-color: #374151;
  }

  .search-result-title {
    color: #f9fafb;
  }

  .search-result-excerpt {
    color: #d1d5db;
  }

  .search-highlight {
    background-color: #fbbf24;
    color: #92400e;
  }
}
```

## 검색 API

### 검색 쿼리 API

프로그래밍 방식으로 검색에 액세스할 수 있습니다:

```typescript
// 검색 API 사용
import { searchAPI } from '@baidocs/search';

// 기본 검색
const results = await searchAPI.search('installation guide', {
  limit: 10,
  offset: 0,
  language: 'en'
});

// 필터가 있는 고급 검색
const advancedResults = await searchAPI.search('configuration', {
  limit: 20,
  filters: {
    book: ['user-guide', 'api-reference'],
    type: ['page', 'heading'],
    tags: ['beginner'],
    section: ['getting-started']
  },
  highlighting: {
    enabled: true,
    preTag: '<mark>',
    postTag: '</mark>'
  },
  sort: 'relevance', // or 'date', 'title'
  fuzzy: {
    enabled: true,
    threshold: 0.7
  }
});

// 검색 제안
const suggestions = await searchAPI.suggest('config', {
  limit: 5,
  includePopular: true
});

// 검색 분석
const analytics = await searchAPI.getAnalytics({
  timeframe: '30d',
  metrics: ['queries', 'clicks', 'zero_results']
});
```

### 검색 결과 인터페이스

```typescript
interface SearchResult {
  // 콘텐츠 식별
  id: string;
  url: string;
  title: string;
  excerpt: string;

  // 콘텐츠 분류
  type: 'page' | 'heading' | 'section' | 'code';
  book: string;
  language: string;
  section?: string;

  // 검색 메타데이터
  score: number;
  highlights: SearchHighlight[];
  matchedTerms: string[];

  // 콘텐츠 메타데이터
  lastModified: string;
  wordCount: number;
  tags: string[];
  author?: string;
}

interface SearchHighlight {
  field: string; // 'title', 'content', 'heading'
  highlights: string[];
  positions: Array<{ start: number; end: number }>;
}
```

## 다국어 검색

### 언어별 구성

여러 언어에 대한 검색을 구성할 수 있습니다:

```yaml
# book.config.yaml
languages:
  - en
  - ko
  - es

search:
  # 언어별 설정
  languages:
    en:
      stemming: true
      stopWords: ["the", "is", "at", "which", "on"]
      synonyms:
        setup: ["installation", "configuration"]
        guide: ["tutorial", "walkthrough"]

    ko:
      stemming: false  # 한국어는 전통적인 어간 추출을 사용하지 않음
      stopWords: ["이", "그", "저", "것", "등"]
      wordSegmentation: true  # 한국어/중국어/일본어에 활성화

    es:
      stemming: true
      stopWords: ["el", "la", "es", "en", "de"]

  # 언어 간 검색
  crossLanguage:
    enabled: true
    defaultLanguage: en
    translateQueries: true
```

### 언어 감지

검색 쿼리에 대한 자동 언어 감지:

```typescript
// 자동 언어 감지
const searchWithAutoDetect = async (query: string) => {
  const detectedLanguage = await searchAPI.detectLanguage(query);

  const results = await searchAPI.search(query, {
    language: detectedLanguage,
    fallbackLanguages: ['en'], // 결과가 없을 경우 대체
    includeTranslations: true
  });

  return results;
};
```

## 검색 분석

### 사용량 추적

검색 사용량 및 성능을 추적할 수 있습니다:

```yaml
# book.config.yaml
search:
  analytics:
    enabled: true

    # 검색 이벤트 추적
    tracking:
      queries: true
      results: true
      clicks: true
      zeroResults: true

    # 개인정보 보호 설정
    privacy:
      anonymizeQueries: true
      retentionDays: 90
      excludePersonalInfo: true

    # 성능 모니터링
    performance:
      trackLatency: true
      trackIndexSize: true
      slowQueryThreshold: 500  # ms
```

### 검색 메트릭 대시보드

검색 분석에 액세스할 수 있습니다:

```typescript
// 검색 분석
const analytics = await searchAPI.getAnalytics({
  timeframe: '30d',
  metrics: [
    'total_queries',
    'unique_queries',
    'click_through_rate',
    'zero_result_rate',
    'average_latency',
    'popular_queries',
    'popular_results'
  ]
});

// 인기 검색어
const popularQueries = await searchAPI.getPopularQueries({
  timeframe: '7d',
  limit: 10,
  language: 'en'
});

// 검색 성능
const performance = await searchAPI.getPerformanceMetrics({
  timeframe: '24h',
  includeSlowQueries: true
});
```

## 검색 최적화

### 인덱스 최적화

더 나은 성능을 위해 검색 인덱스를 최적화할 수 있습니다:

```yaml
# book.config.yaml
search:
  optimization:
    # 인덱스 압축
    compression:
      enabled: true
      algorithm: 'gzip'
      level: 6

    # 인덱스 분할
    segmentation:
      enabled: true
      maxDocumentsPerSegment: 1000
      mergeThreshold: 10

    # 메모리 최적화
    memory:
      indexCacheSize: '100MB'
      queryCacheSize: '50MB'
      enableLazyLoading: true

    # 업데이트 전략
    updates:
      incremental: true
      batchSize: 100
      debounceMs: 1000
```

### 쿼리 최적화

검색 쿼리를 최적화할 수 있습니다:

```typescript
// 쿼리 최적화 기법
const optimizedSearch = {
  // 쿼리 부스팅 사용
  async boostQuery(query: string, boosts: Record<string, number>) {
    return searchAPI.search(query, {
      fieldBoosts: {
        title: boosts.title || 2.0,
        headings: boosts.headings || 1.5,
        content: boosts.content || 1.0,
        tags: boosts.tags || 3.0
      }
    });
  },

  // 쿼리 확장 구현
  async expandQuery(query: string) {
    const synonyms = await searchAPI.getSynonyms(query);
    const expandedQuery = [query, ...synonyms].join(' OR ');

    return searchAPI.search(expandedQuery, {
      operator: 'OR',
      minimumShouldMatch: 1
    });
  },

  // 패싯 검색 사용
  async facetedSearch(query: string, facets: string[]) {
    return searchAPI.search(query, {
      facets: facets,
      facetFilters: {},
      includeFacetCounts: true
    });
  }
};
```

## 문제 해결

### 일반적인 문제

#### "Search Not Working"

```bash
# 검색 인덱스 존재 확인
ls -la _data/search/

# 검색 인덱스 재빌드
npm run build:search

# 검색 구성 확인
npm run validate-search-config
```

#### "Slow Search Performance"

```yaml
# 검색 성능 최적화
search:
  optimization:
    enableCaching: true
    maxCachedQueries: 1000
    cacheExpiry: 3600  # 1시간

  indexing:
    batchSize: 500
    concurrency: 4
    enableCompression: true
```

#### "Search Results Not Relevant"

```yaml
# 결과 관련성 개선
search:
  ranking:
    titleBoost: 3.0
    headingBoost: 2.0
    contentBoost: 1.0
    exactMatchBoost: 2.0

  behavior:
    enableStemming: true
    enableSynonyms: true
    fuzzyThreshold: 0.7
```

### 검색 문제 디버그

```typescript
// 검색 기능 디버그
const debugSearch = {
  // 검색 인덱스 테스트
  async testIndex() {
    const stats = await searchAPI.getIndexStats();
    console.log('Index stats:', stats);

    const health = await searchAPI.checkIndexHealth();
    console.log('Index health:', health);
  },

  // 특정 쿼리 디버그
  async debugQuery(query: string) {
    const explanation = await searchAPI.explain(query, {
      includeScoring: true,
      includeAnalysis: true
    });

    console.log('Query explanation:', explanation);
  },

  // 검색 성능 테스트
  async benchmarkSearch(queries: string[]) {
    const results = [];

    for (const query of queries) {
      const start = Date.now();
      await searchAPI.search(query);
      const duration = Date.now() - start;

      results.push({ query, duration });
    }

    console.log('Search benchmark:', results);
  }
};
```

## 다음 단계

검색 경험을 향상시키는 방법:

1. **[다국어 지원](multilingual.mdx)** - 여러 언어에 대한 검색 구성
2. **[버전 관리](versioning.mdx)** - 다른 문서 버전 간 검색
3. **[테마](themes.mdx)** - 테마와 일치하도록 검색 인터페이스 스타일링

---

*강력한 검색 기능은 사용자가 필요한 것을 정확히 찾을 수 있도록 도와주어 문서를 더 접근 가능하고 가치 있게 만듭니다.*