# Vercel Deployment

Deploy BaiDocs to Vercel for global, scalable, and maintenance-free documentation hosting. This deployment focuses on the viewer application for public access while keeping the editor for local use.

## Overview

### Vercel Deployment Strategy

BaiDocs follows a hybrid deployment model optimized for both development and production:

- **Viewer on Vercel**: Public documentation accessible globally
- **Editor Local**: Content editing remains on your local machine or private server
- **Git Integration**: Automatic deployment on content changes
- **Global CDN**: Fast content delivery worldwide

### Architecture

```
BaiDocs Vercel Deployment:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Local Editor    â”‚    â”‚ Git Repository  â”‚    â”‚ Vercel Viewer   â”‚
â”‚ (localhost:3001)â”‚â”€â”€â”€â”€â”‚ (GitHub/GitLab) â”‚â”€â”€â”€â”€â”‚ (Global CDN)    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ - Content edit  â”‚    â”‚ - Source of     â”‚    â”‚ - Public docs   â”‚
â”‚ - Live preview  â”‚    â”‚   truth         â”‚    â”‚ - Search        â”‚
â”‚ - Git push      â”‚    â”‚ - Auto-deploy   â”‚    â”‚ - Fast loading  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Prerequisites

### Required Accounts

- **Vercel Account**: Sign up at [vercel.com](https://vercel.com)
- **Git Repository**: GitHub, GitLab, or Bitbucket repository
- **Domain (Optional)**: Custom domain for branding

### Repository Preparation

Ensure your repository is properly structured:

```
your-docs-repository/
â”œâ”€â”€ book.config.yaml          # BaiDocs configuration
â”œâ”€â”€ en/                      # English content
â”‚   â”œâ”€â”€ index.mdx
â”‚   â”œâ”€â”€ getting-started/
â”‚   â””â”€â”€ _assets/
â”œâ”€â”€ ko/                      # Korean content (optional)
â”‚   â”œâ”€â”€ index.mdx
â”‚   â””â”€â”€ getting-started/
â”œâ”€â”€ .gitignore              # Exclude unnecessary files
â””â”€â”€ README.md               # Repository documentation
```

## Vercel Setup

### Step 1: Connect Repository

1. **Login to Vercel**:
   - Go to [vercel.com](https://vercel.com)
   - Sign in with your Git provider

2. **Import Project**:
   - Click "New Project"
   - Select your documentation repository
   - Choose the repository containing your BaiDocs content

![Vercel Import Project](../_assets/vercel-import.png)

### Step 2: Configure Build Settings

Configure the build and deployment settings:

**Framework Preset**: Custom

**Build Settings**:
```bash
# Build Command
npm run build:viewer

# Output Directory
apps/viewer/.next

# Install Command
npm install

# Development Command
npm run dev:viewer
```

**Environment Variables**:
```bash
# Required environment variables
CONTENT_PATH=./content
NEXT_PUBLIC_VIEWER_URL=https://your-domain.vercel.app

# Optional customization
NODE_ENV=production
ENABLE_SEARCH=true
ENABLE_PDF_GENERATION=true
```

### Step 3: Project Configuration

Create `vercel.json` in your repository root:

```json
{
  "version": 2,
  "framework": "nextjs",
  "buildCommand": "npm run build:viewer",
  "outputDirectory": "apps/viewer/.next",
  "installCommand": "npm install",
  "functions": {
    "apps/viewer/src/app/api/**": {
      "memory": 1024
    }
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    },
    {
      "source": "/_assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/pdfs/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=604800"
        }
      ]
    }
  ],
  "redirects": [
    {
      "source": "/docs/:path*",
      "destination": "/:path*",
      "permanent": true
    }
  ],
  "rewrites": [
    {
      "source": "/((?!api/).*)",
      "destination": "/index.html"
    }
  ],
  "regions": ["iad1", "sfo1", "lhr1", "hnd1"],
  "github": {
    "autoJobCancelation": false
  }
}
```

### Step 4: Deploy

1. **Deploy Project**:
   - Click "Deploy"
   - Wait for the initial deployment to complete
   - View your documentation at the provided URL

2. **Verify Deployment**:
   - Check that all pages load correctly
   - Verify navigation works
   - Test search functionality
   - Confirm images and assets load

## Automatic Deployments

### Git Integration

Vercel automatically deploys when you push changes:

```bash
# Make content changes locally
echo "# Updated Content" > en/new-page.mdx

# Commit and push changes
git add .
git commit -m "Add new documentation page"
git push origin main

# Vercel automatically detects the push and deploys
```

### Branch Deployments

Configure different deployment strategies:

**Production Deployment** (main branch):
```json
{
  "git": {
    "deploymentEnabled": {
      "main": true
    }
  }
}
```

**Preview Deployments** (feature branches):
- Automatic preview URLs for pull requests
- Test changes before merging to main
- Shareable preview links for review

### Deployment Hooks

Set up webhook for external triggers:

```bash
# Create deployment hook in Vercel dashboard
# Use the hook URL to trigger deployments

curl -X POST "https://api.vercel.com/v1/integrations/deploy/[HOOK_ID]" \
     -H "Content-Type: application/json" \
     -d '{
       "ref": "main",
       "target": "production"
     }'
```

## Custom Domain Configuration

### Step 1: Add Domain

1. **In Vercel Dashboard**:
   - Go to your project settings
   - Click "Domains"
   - Add your custom domain

2. **Domain Types**:
   - `docs.yourcompany.com` (subdomain)
   - `yourcompany.com/docs` (path-based)
   - `yourdocs.com` (separate domain)

### Step 2: DNS Configuration

Configure your DNS records:

**For Subdomain (`docs.yourcompany.com`)**:
```
Type: CNAME
Name: docs
Value: cname.vercel-dns.com
```

**For Apex Domain (`yourdocs.com`)**:
```
Type: A
Name: @
Value: 76.76.19.19

Type: A
Name: @
Value: 76.76.21.21
```

### Step 3: SSL Certificate

Vercel automatically provides SSL certificates:
- Automatic SSL provisioning
- Certificate auto-renewal
- HTTPS redirect enabled by default

## Performance Optimization

### Edge Functions

Optimize performance with edge functions:

```typescript
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // Redirect legacy URLs
  if (request.nextUrl.pathname.startsWith('/old-docs')) {
    return NextResponse.redirect(
      new URL('/docs' + request.nextUrl.pathname.slice(9), request.url)
    );
  }

  // Add security headers
  const response = NextResponse.next();

  response.headers.set('X-Frame-Options', 'DENY');
  response.headers.set('X-Content-Type-Options', 'nosniff');
  response.headers.set('Referrer-Policy', 'origin-when-cross-origin');

  return response;
}

export const config = {
  matcher: [
    /*
     * Match all request paths except for the ones starting with:
     * - api (API routes)
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     */
    '/((?!api|_next/static|_next/image|favicon.ico).*)',
  ],
};
```

### Caching Strategy

Optimize caching for better performance:

```json
{
  "headers": [
    {
      "source": "/_assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/_next/static/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/pdfs/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=604800"
        }
      ]
    },
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=3600, stale-while-revalidate=86400"
        }
      ]
    }
  ]
}
```

### Image Optimization

Configure Vercel's image optimization:

```typescript
// next.config.js
module.exports = {
  images: {
    domains: ['raw.githubusercontent.com', 'your-image-domain.com'],
    formats: ['image/webp', 'image/avif'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
    minimumCacheTTL: 60,
  },
};
```

## Environment Configuration

### Production Environment Variables

Configure production-specific settings:

```bash
# In Vercel Dashboard > Settings > Environment Variables

# Core Configuration
CONTENT_PATH=./content
NODE_ENV=production

# URLs
NEXT_PUBLIC_VIEWER_URL=https://docs.yourcompany.com
NEXT_PUBLIC_EDITOR_URL=http://localhost:3001

# Search Configuration
ENABLE_SEARCH=true
SEARCH_PROVIDER=vercel

# PDF Generation
ENABLE_PDF_GENERATION=true
PDF_QUALITY=high

# Analytics (optional)
VERCEL_ANALYTICS_ID=your-analytics-id
GOOGLE_ANALYTICS_ID=GA-XXXXXXXXX

# Content Security
CONTENT_SECURITY_POLICY=strict
```

### Multi-Environment Setup

Configure different environments:

**Production** (main branch):
```bash
ENVIRONMENT=production
NEXT_PUBLIC_API_URL=https://api.yourcompany.com
ENABLE_DEBUG=false
```

**Staging** (develop branch):
```bash
ENVIRONMENT=staging
NEXT_PUBLIC_API_URL=https://staging-api.yourcompany.com
ENABLE_DEBUG=true
```

**Preview** (feature branches):
```bash
ENVIRONMENT=preview
NEXT_PUBLIC_API_URL=https://dev-api.yourcompany.com
ENABLE_DEBUG=true
```

## Monitoring and Analytics

### Vercel Analytics

Enable Vercel's built-in analytics:

```typescript
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  );
}
```

### Custom Analytics

Integrate Google Analytics or other services:

```typescript
// lib/analytics.ts
export const GA_TRACKING_ID = process.env.NEXT_PUBLIC_GA_ID;

export const pageview = (url: string) => {
  window.gtag('config', GA_TRACKING_ID, {
    page_path: url,
  });
};

export const event = ({ action, category, label, value }: {
  action: string;
  category: string;
  label?: string;
  value?: number;
}) => {
  window.gtag('event', action, {
    event_category: category,
    event_label: label,
    value: value,
  });
};
```

### Performance Monitoring

Monitor Core Web Vitals:

```typescript
// lib/vitals.ts
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric: any) {
  // Send to your analytics service
  console.log(metric);
}

getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);
```

## Security Configuration

### Content Security Policy

Implement CSP headers:

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Content-Security-Policy",
          "value": "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://vercel.live https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://vitals.vercel-insights.com; frame-ancestors 'none';"
        }
      ]
    }
  ]
}
```

### Access Control

Configure access restrictions:

```typescript
// middleware.ts - Add authentication for sensitive docs
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // Protect internal documentation
  if (request.nextUrl.pathname.startsWith('/internal')) {
    const authHeader = request.headers.get('authorization');

    if (!authHeader || !isValidToken(authHeader)) {
      return NextResponse.json(
        { error: 'Authentication required' },
        { status: 401 }
      );
    }
  }

  return NextResponse.next();
}

function isValidToken(token: string): boolean {
  // Implement your authentication logic
  return token === `Bearer ${process.env.ACCESS_TOKEN}`;
}
```

## CI/CD Integration

### GitHub Actions

Automated deployment with GitHub Actions:

```yaml
# .github/workflows/deploy.yml
name: Deploy to Vercel

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  Deploy-Preview:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - uses: actions/checkout@v3

      - name: Install Vercel CLI
        run: npm install --global vercel@latest

      - name: Pull Vercel Environment Information
        run: vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}

      - name: Build Project Artifacts
        run: vercel build --token=${{ secrets.VERCEL_TOKEN }}

      - name: Deploy Project Artifacts to Vercel
        id: deploy
        run: |
          url=$(vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }})
          echo "preview_url=$url" >> $GITHUB_OUTPUT

      - name: Comment Preview URL
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ðŸ“– Preview deployed: ${{ steps.deploy.outputs.preview_url }}`
            })

  Deploy-Production:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3

      - name: Install Vercel CLI
        run: npm install --global vercel@latest

      - name: Pull Vercel Environment Information
        run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

      - name: Build Project Artifacts
        run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}

      - name: Deploy Project Artifacts to Vercel
        run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}

  Lighthouse:
    needs: Deploy-Preview
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - uses: actions/checkout@v3

      - name: Run Lighthouse CI
        uses: treosh/lighthouse-ci-action@v9
        with:
          urls: |
            ${{ needs.Deploy-Preview.outputs.preview_url }}
          uploadArtifacts: true
          temporaryPublicStorage: true
```

## Troubleshooting

### Common Issues

#### Build Failures

```bash
# Check build logs in Vercel dashboard
# Common issues and solutions:

# 1. Missing dependencies
# Solution: Ensure package.json includes all required packages

# 2. Environment variable issues
# Solution: Verify all required env vars are set in Vercel dashboard

# 3. Memory issues
# Solution: Increase function memory in vercel.json
{
  "functions": {
    "apps/viewer/src/app/api/**": {
      "memory": 1024
    }
  }
}
```

#### Deployment Timeouts

```json
{
  "builds": [
    {
      "src": "apps/viewer/package.json",
      "use": "@vercel/node",
      "config": {
        "maxLambdaSize": "50mb"
      }
    }
  ]
}
```

#### Custom Domain Issues

```bash
# Check DNS configuration
dig docs.yourcompany.com

# Verify CNAME record
nslookup docs.yourcompany.com

# Check SSL certificate status in Vercel dashboard
```

### Performance Issues

#### Slow Build Times

```json
{
  "build": {
    "env": {
      "SKIP_TYPE_CHECK": "true",
      "NEXT_TELEMETRY_DISABLED": "1"
    }
  }
}
```

#### Large Bundle Size

```typescript
// next.config.js - Bundle analysis
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

module.exports = withBundleAnalyzer({
  // Your next.js config
});
```

### Monitoring and Debugging

```bash
# Check deployment status
vercel --version
vercel list
vercel logs [deployment-url]

# Debug build issues
vercel build --debug

# Test deployment locally
vercel dev
```

## Best Practices

### Content Management

1. **Separate Content Repository**: Keep content in a dedicated repository
2. **Branch Strategy**: Use main for production, develop for staging
3. **Commit Messages**: Use clear, descriptive commit messages
4. **Review Process**: Use pull requests for content changes

### Performance

1. **Image Optimization**: Use Vercel's image optimization
2. **Static Generation**: Pre-generate pages when possible
3. **Caching**: Configure appropriate cache headers
4. **Bundle Optimization**: Minimize JavaScript bundle size

### Security

1. **Environment Variables**: Never commit secrets to Git
2. **Content Security**: Implement CSP headers
3. **Access Control**: Restrict access to sensitive content
4. **Regular Updates**: Keep dependencies updated

## Next Steps

Complete your Vercel deployment:

1. **[Local Deployment](local.mdx)** - Set up local editor environment
2. **[Search Configuration](../advanced/search.mdx)** - Optimize search for production
3. **[Multi-language Support](../advanced/multilingual.mdx)** - Deploy multilingual docs

---

*Vercel deployment provides a scalable, global platform for your documentation with minimal maintenance and maximum performance.*